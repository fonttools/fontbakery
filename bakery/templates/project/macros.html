{% macro nav(active) -%}
  <h2>{{ project.title }}</h2>
  <p>
     <a href="{{ project.clone }}">{{ project.clone }} <i class="icon-signout"></i></a>
  </p>
  <h2>{{ page_title }}</h2>
  <ul class="nav nav-tabs">
        <li class="dropdown {% if active in ['fonts', 'license', 'ufonts'] %}active{% endif %}">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
               Upstream <i class="caret"></i>
          </a>
          <ul class="dropdown-menu">
              <li {% if active == 'fonts' %}class="active" {% endif %}><a href="{{ url_for('project.fonts', project_id=project.id) }}">Browse Files</a></li>
              <li {% if active == 'license' %}class="active" {% endif %}><a href="{{ url_for('project.plicense', project_id=project.id ) }}" >License</a></li>
              <li {% if active == 'ufonts' %}class="active" {% endif %}><a href="{{ url_for('project.utests', project_id=project.id) }}">Upstream tests</a></li>
          </ul>
        </li>
        <li {% if active == 'setup' %}class="active"{% endif %}><a href="{{ url_for('project.setup', project_id = project.id )}}">Setup</a></li>
      {% if project.config['local'].get('setup', None) %}
          <li {% if active == 'log' %}class="active" {% endif %}><a href="{{ url_for('project.log', project_id=project.id ) }}" >Log</a></li>
          <li class="dropdown {% if active in ['yaml', 'metadatajson', 'description', 'rfonts'] %}active{% endif %}">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                 _out <i class="caret"></i>
            </a>
            <ul class="dropdown-menu">
<!-- TODO: Add a files page for browsing the _out directory, reading directly from the file system
                <li class="nav-header">Folders</li>
                <li {% if active == 'fonts' %}class="active" {% endif %}><a href="{{ url_for('project.fonts', project_id=project.id) }}">Browse</a></li>
-->
                <li {% if active == 'rfonts' %}class="active" {% endif %}><a href="{{ url_for('project.rtests', project_id=project.id) }}">Results tests</a></li>
                <li class="nav-header">Read Only Files</li>
                <li {% if active == 'yaml' %}class="active" {% endif %}><a href="{{ url_for('project.bakeryyaml', project_id=project.id ) }}" >bakery.yaml</a></li>
                <li class="nav-header">Editable Files</li>
                <li {% if active == 'metadatajson' %}class="active" {% endif %}><a href="{{ url_for('project.metadatajson', project_id=project.id ) }}" >METADATA.json</a></li>
                <li {% if active == 'description' %}class="active" {% endif %}><a href="{{ url_for('project.description_edit', project_id=project.id ) }}" >DESCRIPTION.en_us.html</a></li>
            </ul>
          </li>
      {% endif %}
  </ul>
{%- endmacro %}

{%- macro highlight(name) %}{%set highlight_files = ['license.txt', 'ofl.txt', 'fontlog.txt', 'readme.txt', 'readme.md' ] 
 %}{% if name.lower() in highlight_files or name.lower().endswith('.ufo') 
  %}class="highlight"{% endif 
%}{%- endmacro %}

{%- macro filestree(tree) %}
  <div class="tree">
    <ul>
      <li><a><i class="icon-folder-open"></i></a></li>
      <ul>
      {%- for key, value in project.tree_in().items() recursive %}
        <li class="{% if key == 'glyphs' and value %}mother_of_glyphs{% elif key.lower().endswith('.ufo') %}mothership{% endif %}">
          <a {{ highlight(key) }}>{% if key == '' %}
            &nbsp;
          {% else %}
            {%   if key.lower().endswith('.ufo') and value %}<i class="icon-font text-info"></i>
            {% elif key.lower().endswith('.otf') %}<i class="icon-file"></i>
            {% elif key.lower().endswith('.ttf') %}<i class="icon-file"></i>
            {% elif key.lower().split('.')[-1] in ['txt', 'md', 'mdown', 'markdown'] %}<i class="icon-book"></i>
            {% elif key.lower().split('.')[-1] in ['plist'] %}<i class="icon-list"></i>
            {% elif key in ['glyphs', 'ttf', 'otf', 'src', 'sources'] %}<i class="icon-folder-close"></i>
            {% elif key == 'bakery.yaml' %}<i class="icon-rocket text-error"></i>
            {% else %}<i class="icon-file-alt muted"></i>
            {%endif%}{{ key }}
          {% endif %}</a>
        {%- if value %}<ul class="{% if key == 'glyphs' %}glyphs{% elif key.lower().endswith('.ufo') %}ufo-files{% endif %}">{{ loop(value.items())}}</ul>{%- endif %}
        </li>
      {%- endfor %}
      </ul>
    </ul>
  </div>  
{%- endmacro %}
