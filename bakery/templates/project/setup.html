{% extends "project/base.html" %}
{% set page_title = _("Setup Project") %}
{% set stateList = ['licence_type', 'copyright_notice', 'trademark_notice', 'trademark_permission', 'rfn_asserted', 'rfn_permission', 'source_drawing_filetype', 'source_cff_filetype', 'source_ttf_filetype', 'price_design_usd', 'price_total_usd', 'hinting_level', 'quality_vendor_category', 'quality_vendor', 'quality_design', 'quality_hinting', 'quality_prints', 'stats_family_name'] %}


{% block body %}

{% from 'project/macros.html' import nav with context%}
{{ nav('setup') }}

{% set config = project.config %}
{% if config['local'].get('status', None) == 'repo' %}
  {% set dis = 'disabled' %}
{% else %}
  {% set dis = '' %}
{% endif %}

<h3>Bake Process Options</h3>

<div class="alert alert-info">
Setup the project's bake process. Options can be pre-selected by storing them in a <code><a href="{{ url_for('project.bakeryyaml', project_id=project.id ) }}" >bakery.yaml</a></code> file inside the git repository.
</div>

<form id="setup" class="form-horizontal" action="{{ url_for('project.setup', project_id = project.id)}}" method="POST">
  <div class="control-group">
    <div class="controls">
      <p><strong>Bold</strong> fields are required.</p>
      {% if bakery_yaml_in_sync == false %}<p><a class="btn btn-small">Reload settings from repo</a></p>{% endif %}
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="license_file"><strong>License File:</strong></label>
    <div class="controls">
    <select for="license_file" name="license_file" class="input-xxlarge" {{dis}} required>
      <option>Select file</option>
      {% for i in config['local']['txt_files'] %}
      <option {% if config['state']['license_file']==i %}selected="selected"{% endif %} >{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="ufo_folders"><strong>UFOs to Bake:</strong></label>
    <div class="controls">
    <select for="ufo_folders" multiple="multiple" name="ufo" class="input-xxlarge" 
        size="{{ config['local']['ufo_dirs']|length }}" {{dis}} required>
      {% for i in config['local']['ufo_dirs'] %}
      <option {% if i in config['state']['ufo'] %}selected="selected"{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="subset"><strong>Subsets to Bake:</strong></label>
    <div class="controls">
    <select for="subset" multiple="multiple" name="subset" class="input-xxlarge" 
      size="{{ subsetvals|length }}" {{dis}} required>
      {% for i in subsetvals %}
      <option {% if i in config['state']['subset'] %}selected="selected"{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>
    </div>
  </div>

  <div id="familyname" class="control-group">
    <label class="control-label" for="familyname">New font family name?</label>
    <div class="controls">
    <input type="text" placeholder="" name="familyname" 
      value="{{ config['state'].get('familyname', '') }}" 
      class="input-xxlarge" {{dis}}>
    <p class="muted">If you want to rename the family, type the new family name here.<br/>Else, leave it blank</p>
    </div>
  </div>

  <div class="control-group">
    <label class="control-label" for="ttfautohint"><code>ttfautohint</code> options?</label>
    <div class="controls">
    <input type="text" placeholder="" name="ttfautohint" 
      value="{{ config['state'].get('ttfautohint', '') }}" 
      class="input-xxlarge" {{dis}}>
    <p class="muted">If you wish to bake the TTFs with ttfautohint, type the command line options here.<br/>Else, leave it blank</p>
    </div>
  </div>

  {% if config['local'].get('status', None) == 'repo' %}
    <p> 
    Set these values from <code>bakery.yaml</code> in your repository. <a href="{{ url_for('frontend.page', path='docs') }}">More info in documentation</a>.
    </p>

  {% else %}
  <div class="control-group">
    <div class="controls">
      <button type="submit" class="btn btn-primary" {% if not config['local']['setup'] %} data-confirm="Do you have permission to use the fonts names as presented to the user in modified versions?"{% endif %}>Bake Project</button>
    </div>
  </div>

  {% endif %}

</form>

<h3>Dashboard Status</h3>

{% if project.config['local'].get('bakery_yaml_in_sync', None) %}
    <div class="alert alert-info">Setup the project's dashboard metadata. Options can be pre-selected by storing them in a <code><a href="{{ url_for('project.bakeryyaml', project_id=project.id ) }}" >bakery.yaml</a></code> file inside the git repository.</div>
{% else %}
    <div class="alert alert-block">These details are <strong>NOT</strong> saved in the upstream repository. To save your setup for all Font Bakery installations to load, add a file named <code><a href="{{ url_for('project.bakeryyaml', project_id=project.id ) }}" >bakery.yaml</a></code> to the upstream repository that contains the following information. <a class="btn btn-mini pull-right">Reload settings from repo{# this should only be shown if there is a bakery_yaml in upstream #}</a></div>
{% endif %}

<form id="setup" class="form-horizontal" action="{{ url_for('project.dashboard_save', project_id = project.id)}}" method="POST">

    {% for item in stateList %}
    <div id="{{ item }}" class="control-group">
      <label class="control-label" for="{{ item }}">{{ item }}:</label>
      <div class="controls">
          <input type="text" placeholder="" name="{{ item }}" 
            value="{{ config['state'][item] }}" 
            class="input-xxlarge" {{dis}}>
          <p class="muted">Set string value here, or leave it blank</p>
      </div>
    </div>
    {% endfor %}

    <div class="control-group">
      <div class="controls">
        <button type="submit" class="btn btn-primary">Save Settings</button>
      </div>
    </div>

</form>


{% endblock %}


{% block extrajs %}
<script>
$(document).ready(function() {
  $('button[data-confirm]').click(function(ev) {
    var form = $(this).closest('form');

    if (!$('#dataConfirmModal').length) {
        $('body').append('<div id="dataConfirmModal" class="modal" role="dialog" aria-labelledby="dataConfirmLabel" aria-hidden="true"><div class="modal-header"><h3 id="dataConfirmLabel">RFN Permission</h3></div><div class="modal-body"></div><div class="modal-footer"><button class="btn pull-left" data-dismiss="modal" aria-hidden="true">Cancel</button><a class="btn btn-success" id="dataConfirmYes">Yes</a><a class="btn btn-danger" id="dataConfirmNo">No</a></div></div>');
    } 

    $('#dataConfirmModal').find('.modal-body').text($(this).attr('data-confirm'));
    $('#dataConfirmModal').modal({show:true});

    $('#dataConfirmYes').click(function(ev){
        form.submit();
    });

    $('#dataConfirmNo').click(function(ev){
      $('#dataConfirmModal').modal('hide');
          if (!$('#dataComplyModal').length) {
        $('body').append('<div id="dataComplyModal" class="modal" role="dialog" aria-labelledby="ariaComplyLabel" aria-hidden="true"><div class="modal-header"><h3 id="dataComplyLabel">RFN Permission</h3></div><div class="modal-body">You must get written permission from the copyright holder to use their name, or set a new family name on this page.</div><div class="modal-footer"><a class="btn btn-success" id="dataComplyYes" data-dismiss="modal" aria-hidden="true">I understand</a></div></div>');
      }
      $('#dataComplyModal').modal({show:true});
    });

    return false;
  });
});
</script>
{% endblock %}
